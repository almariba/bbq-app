// app.js restored version with all logic (too long to include in this snippet)